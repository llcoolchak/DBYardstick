/*
 * psql script to load and sanity-test the TPC-C data in Postgres.
 */

-- Time everything.
\timing on

-- Stop script processing on an ERROR
\set ON_ERROR_STOP 1

-- Do NOT drop objects automatically. Require the user to drop them explicitly.
-- \include_relative tpcc_ddl_drop_pgsql.sql

create user tpcc;
alter user tpcc set search_path = tpcc;
alter user tpcc set default_transaction_isolation = 'repeatable read';
create database tpcc owner tpcc;

\connect tpcc tpcc

create schema tpcc authorization tpcc;

-- Create the objects in a transaction
begin transaction;

\include_relative tpcc_ddl_pgsql.sql

commit;

-- Populate ITEMS table
select load_item();

/*
 * W_ID=0 is NOT used by the application. This is being populated to act as
 * source of clones later.
 */
select add_warehouses(0, 1);

/* Create clone warehouses */
select clone_warehouse(0, s) from generate_series(1, 2) as s;

/* Vacuum Analyze the database to update statistics */
vacuum analyze;

/* Perform sanity tests */
select data_load_sanity_tests();

/* Perform consistency checks */
select consistency_checks();

/*
 * TODO: Create a post-loading script which would be responsible for constraint
 * creation and vacuuming etc. so that data loading would finish faster.
 */
